# # Sample qrels data
# qrels = [
#     (0, 0, 40, 1),
#     (0, 0, 62, 0),
#     (0, 0, 94, 1),
#     (0, 0, 82, 0),
#     (1, 0, 40, 1),
#     (1, 0, 62, 1),
#     (1, 0, 142, 1),
#     (1, 0, 94, 0),
#     (2, 0, 79, 1),
#     (2, 0, 53, 1),
#     (2, 0, 73, 1),
#     (2, 0, 91, 0),
#     (3, 0, 94, 1),
#     (3, 0, 56, 1),
#     (3, 0, 76, 1),
#     (3, 0, 101, 0),
#     (4, 0, 60, 1),
#     (4, 0, 0, 1),
#     (4, 0, 98, 0),
#     (4, 0, 27, 0),
#     (5, 0, 142, 1),
#     (5, 0, 143, 0),
#     (5, 0, 112, 0),
#     (5, 0, 117, 0),
#     (6, 0, 74, 1),
#     (6, 0, 92, 1),
#     (6, 0, 96, 1),
#     (6, 0, 54, 1),
#     (7, 0, 142, 1),
#     (7, 0, 117, 0),
#     (7, 0, 4, 0),
#     (7, 0, 91, 0),
#     # (8, 0, 143, 0),
#     # (8, 0, 142, 0),
#     # (8, 0, 52, 0),
#     # (8, 0, 72, 0),
#     (9, 0, 0, 0),
#     (9, 0, 86, 1),
#     (9, 0, 52, 0),
#     (9, 0, 72, 0),
#     # (10, 0, 60, 0),
#     # (10, 0, 0, 0),
#     # (10, 0, 143, 0),
#     # (10, 0, 52, 0),
#     (11, 0, 129, 1),
#     (11, 0, 112, 1),
#     (11, 0, 121, 1),
#     (11, 0, 96, 0),
#     (12, 0, 113, 1),
#     (12, 0, 41, 1),
#     (12, 0, 61, 1),
#     (12, 0, 85, 0),
#     (13, 0, 129, 1),
#     (13, 0, 101, 1),
#     (13, 0, 21, 0),
#     (13, 0, 31, 1),
#     (14, 0, 106, 1),
#     (14, 0, 24, 1),
#     (14, 0, 136, 1),
#     (14, 0, 34, 0),
#     (15, 0, 10, 1),
#     (15, 0, 103, 1),
#     (15, 0, 1, 0),
#     (15, 0, 22, 0),
#     # (16, 0, 52, 0),
#     # (16, 0, 72, 0),
#     # (16, 0, 90, 0),
#     # (16, 0, 27, 0),
#     (17, 0, 52, 1),
#     (17, 0, 72, 0),
#     (17, 0, 90, 0),
#     (17, 0, 107, 0),
#     (18, 0, 52, 1),
#     (18, 0, 72, 1),
#     (18, 0, 90, 1),
#     (18, 0, 143, 0),
#     (19, 0, 64, 1),
#     (19, 0, 44, 1),
#     (19, 0, 82, 1),
#     (19, 0, 80, 0),
# ]

# mergeQuery

# qrels = [
#     (0, 0, 120, 1),
#     (0, 0, 121, 1),
#     (0, 0, 112, 1),
#     (0, 0, 129, 1),
#     (1, 0, 113, 1),
#     (1, 0, 41, 1),
#     (1, 0, 61, 1),
#     (1, 0, 85, 1),
#     (2, 0, 129, 1),
#     (2, 0, 101, 1),
#     (2, 0, 109, 0),
#     (2, 0, 21, 1),
#     (3, 0, 52, 1),
#     (3, 0, 72, 1),
#     (3, 0, 90, 1),
#     (3, 0, 143, 0),
#     (4, 0, 15, 1),
#     (4, 0, 23, 0),
#     (4, 0, 124, 1),
#     (4, 0, 62, 0),
#     (5, 0, 105, 1),
#     (5, 0, 118, 1),
#     (5, 0, 134, 1),
#     (5, 0, 14, 1),
#     (6, 0, 112, 1),
#     (6, 0, 96, 1),
#     (6, 0, 135, 1),
#     (6, 0, 74, 1),
#     (7, 0, 52, 1),
#     (7, 0, 72, 1),
#     (7, 0, 90, 1),
#     (7, 0, 115, 1),
#     (8, 0, 43, 1),
#     (8, 0, 81, 1),
#     (8, 0, 63, 1),
#     (8, 0, 67, 0),
#     (9, 0, 119, 1),
#     (9, 0, 87, 1),
#     (9, 0, 49, 1),
#     (9, 0, 69, 1),
#     (10, 0, 95, 1),
#     (10, 0, 57, 1),
#     (10, 0, 77, 1),
#     (10, 0, 16, 0),
#     (11, 0, 118, 1),
#     (11, 0, 134, 1),
#     (11, 0, 125, 1),
#     (11, 0, 14, 1),
#     (12, 0, 142, 1),
#     (12, 0, 143, 1),
#     (12, 0, 112, 0),
#     (12, 0, 96, 0),
#     (13, 0, 111, 1),
#     (13, 0, 99, 1),
#     (13, 0, 29, 1),
#     (13, 0, 140, 1),
#     (14, 0, 2, 1),
#     (14, 0, 17, 1),
#     (14, 0, 24, 0),
#     (14, 0, 23, 0),
#     (15, 0, 57, 1),
#     (15, 0, 77, 1),
#     (15, 0, 95, 1),
#     (15, 0, 16, 0),
#     (16, 0, 120, 1),
#     (16, 0, 140, 1),
#     (16, 0, 99, 0),
#     (17, 0, 137, 1),
#     (17, 0, 139, 0),
#     (17, 0, 133, 1),
#     (17, 0, 126, 0),
#     (18, 0, 24, 1),
#     (18, 0, 114, 1),
#     (18, 0, 89, 1),
#     (18, 0, 127, 0),
#     (19, 0, 6, 1),
#     (19, 0, 24, 0),
#     (19, 0, 46, 0),
#     (19, 0, 136, 0),
#     (20, 0, 58, 0),
#     (20, 0, 78, 0),
#     (20, 0, 54, 1),
#     (20, 0, 92, 1),
#     (21, 0, 96, 1),
#     (21, 0, 112, 1),
#     (21, 0, 58, 1),
#     (22, 0, 108, 1),
#     (22, 0, 3, 1),
#     (22, 0, 69, 1),
#     (22, 0, 49, 0),
#     (23, 0, 129, 1),
#     (23, 0, 31, 0),
#     (23, 0, 39, 1),
#     (23, 0, 101, 1),
#     (24, 0, 91, 1),
#     (24, 0, 53, 1),
#     (24, 0, 73, 1),
#     (24, 0, 122, 1),
#     (25, 0, 115, 1),
#     (25, 0, 52, 1),
#     (26, 0, 88, 1),
#     (26, 0, 50, 1),
#     (26, 0, 70, 1),
#     (26, 0, 132, 1),
#     (27, 0, 109, 1),
#     (27, 0, 139, 0),
#     (27, 0, 135, 0),
#     (27, 0, 133, 1),
#     (28, 0, 8, 1),
#     (28, 0, 133, 0),
#     (28, 0, 96, 0),
#     (28, 0, 126, 0),
#     (29, 0, 41, 1),
#     (29, 0, 61, 1),
#     (29, 0, 113, 1),
#     (29, 0, 98, 1)
# ]

qrels = [
    (1, 0, 97, 1),
    (1, 0, 60, 1),
    (1, 0, 113, 0),
    (1, 0, 121, 1),
    (2, 0, 102, 0),
    (2, 0, 139, 0),
    (2, 0, 113, 0),
    (2, 0, 49, 0),
    (3, 0, 130, 0),
    (3, 0, 102, 1),
    (3, 0, 22, 0),
    (3, 0, 32, 0),
    (4, 0, 53, 1),
    (4, 0, 73, 0),
    (4, 0, 91, 1),
    (4, 0, 144, 0),
    (5, 0, 16, 1),
    (5, 0, 8, 0),
    (5, 0, 29, 0),
    (5, 0, 13, 0),
    (6, 0, 106, 1),
    (6, 0, 119, 0),
    (6, 0, 135, 1),
    (6, 0, 15, 0),
    (7, 0, 113, 0),
    (7, 0, 136, 1),
    (7, 0, 97, 0),
    (7, 0, 75, 1),
    (8, 0, 53, 1),
    (8, 0, 73, 0),
    (8, 0, 91, 1),
    (8, 0, 111, 0),
    (9, 0, 44, 0),
    (9, 0, 64, 1),
    (9, 0, 82, 1),
    (9, 0, 77, 0),
    (10, 0, 88, 1),
    (10, 0, 120, 1),
    (10, 0, 70, 1),
    (10, 0, 131, 0),
    (11, 0, 58, 1),
    (11, 0, 78, 0),
    (11, 0, 96, 1),
    (11, 0, 17, 0),
    (12, 0, 126, 1),
    (12, 0, 119, 0),
    (12, 0, 135, 0),
    (12, 0, 106, 0),
    (13, 0, 144, 1),
    (13, 0, 143, 1),
    (13, 0, 53, 0),
    (13, 0, 73, 0),
    (14, 0, 100, 0),
    (14, 0, 112, 1),
    (14, 0, 141, 0),
    (14, 0, 30, 0),
    (15, 0, 3, 1),
    (15, 0, 24, 0),
    (15, 0, 25, 0),
    (15, 0, 107, 0),
    (16, 0, 131, 1),
    (16, 0, 58, 0),
    (16, 0, 78, 1),
    (16, 0, 96, 1),
    (17, 0, 32, 0),
    (17, 0, 121, 0),
    (17, 0, 40, 0),
    (17, 0, 141, 1),
    (18, 0, 138, 1),
    (18, 0, 140, 0),
    (18, 0, 110, 0),
    (18, 0, 134, 0),
    (19, 0, 25, 1),
    (19, 0, 115, 0),
    (19, 0, 90, 1),
    (19, 0, 128, 0),
    (20, 0, 7, 1),
    (20, 0, 25, 0),
    (20, 0, 137, 0),
    (20, 0, 47, 0),
    (21, 0, 93, 1),
    (21, 0, 55, 0),
    (21, 0, 111, 0),
    (21, 0, 75, 1),
    (22, 0, 97, 1),
    (22, 0, 113, 1),
    (22, 0, 60, 0),
    (22, 0, 53, 0),
    (23, 0, 4, 0),
    (23, 0, 109, 1),
    (23, 0, 107, 0),
    (23, 0, 88, 0),
    (24, 0, 130, 1),
    (24, 0, 32, 0),
    (24, 0, 40, 0),
    (24, 0, 110, 0),
    (25, 0, 54, 1),
    (25, 0, 92, 0),
    (25, 0, 74, 0),
    (25, 0, 123, 1),
    (26, 0, 53, 1),
    (26, 0, 73, 0),
    (26, 0, 91, 0),
    (26, 0, 116, 1),
    (27, 0, 51, 1),
    (27, 0, 89, 0),
    (27, 0, 71, 1),
    (27, 0, 133, 0),
    (28, 0, 136, 0),
    (28, 0, 110, 0),
    (28, 0, 140, 0),
    (28, 0, 137, 0),
    (29, 0, 9, 1),
    (29, 0, 134, 0),
    (29, 0, 136, 0),
    (29, 0, 97, 0),
    (30, 0, 99, 1),
    (30, 0, 42, 0),
    (30, 0, 62, 0),
    (30, 0, 80, 0)
]

# Initialize variables to store values
precision_sum = 0
recall_sum = 0
f1_sum = 0
mrr_sum = 0
map_sum = 0

# Initialize counters
query_count = 0
for query_id, _, _, _ in qrels:
    relevant_items = [item_id for qid, _, item_id, rel in qrels if qid == query_id and rel == 1]
    retrieved_items = [item_id for qid, _, item_id, _ in qrels if qid == query_id]

    # Calculate Precision
    precision = len(set(retrieved_items).intersection(relevant_items)) / len(retrieved_items) if len(retrieved_items) > 0 else 0
    precision_sum += precision

    # Calculate Recall
    recall = len(set(retrieved_items).intersection(relevant_items)) / len(relevant_items) if len(relevant_items) > 0 else 0
    recall_sum += recall

    # Calculate F1 Score
    if precision + recall > 0:
        f1 = 2 * (precision * recall) / (precision + recall)
    else:
        f1 = 0
    f1_sum += f1

    # Calculate MRR
    reciprocal_rank = 0
    for rank, item_id in enumerate(retrieved_items, start=1):
        if item_id in relevant_items:
            reciprocal_rank = 1 / rank
            break
    mrr_sum += reciprocal_rank

    # Calculate MAP
    average_precision = 0
    relevant_count = 0
    for rank, item_id in enumerate(retrieved_items, start=1):
        if item_id in relevant_items:
            relevant_count += 1
            precision_at_rank = relevant_count / rank
            average_precision += precision_at_rank
    if relevant_count > 0:
        average_precision /= len(relevant_items)
    map_sum += average_precision

    query_count += 1

# Calculate average values
avg_precision = precision_sum / query_count
avg_recall = recall_sum / query_count
avg_f1 = f1_sum / query_count
avg_mrr = mrr_sum / query_count
avg_map = map_sum / query_count

print(f"Average Precision: {avg_precision:.2f}")
print(f"Average Recall: {avg_recall:.2f}")
print(f"Average F1 Score: {avg_f1:.2f}")
print(f"Mean Reciprocal Rank (MRR): {avg_mrr:.2f}")
print(f"Mean Average Precision (MAP): {avg_map:.2f}")

# (FAQr) D:\Anaconda3\envs\RetFAQ>python Evaluate_retrieval.py
# Average Precision: 0.51
# Average Recall: 0.85
# Average F1 Score: 0.62
# Mean Reciprocal Rank (MRR): 0.82
# Mean Average Precision (MAP): 0.81

#if i remove the queries that dont have any match 
# (FAQr) D:\Anaconda3\envs\RetFAQ>python Evaluate_retrieval.py
# Average Precision: 0.60
# Average Recall: 1.00
# Average F1 Score: 0.72
# Mean Reciprocal Rank (MRR): 0.97
# Mean Average Precision (MAP): 0.96

# (FAQr) D:\Anaconda3\envs\RetFAQ>python Evaluate_retrieval.py   for 30 merge queries
# Average Precision: 0.77
# Average Recall: 1.00
# Average F1 Score: 0.85
# Mean Reciprocal Rank (MRR): 0.98
# Mean Average Precision (MAP): 0.95

# (FAQr) D:\Anaconda3\envs\RetFAQ>python Evaluate_retrieval.py --> with generic merged queries
# Average Precision: 0.55
# Average Recall: 0.93
# Average F1 Score: 0.66
# Mean Reciprocal Rank (MRR): 0.84
# Mean Average Precision (MAP): 0.82

# Average Precision: 0.39  ---> this is the evaluation for generic merged query and the actual FAQ set
# Average Recall: 0.93
# Average F1 Score: 0.53
# Mean Reciprocal Rank (MRR): 0.82
# Mean Average Precision (MAP): 0.76